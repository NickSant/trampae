{"version":3,"sources":["useOptionsGetters.tsx"],"names":["React","NavigationStateContext","useOptionsGetters","key","getOptions","getState","numberOfChildrenListeners","setNumberOfChildrenListeners","useState","optionsGettersFromChild","useRef","addOptionsGetter","parentAddOptionsGetter","useContext","getOptionsFromListener","useCallback","current","hasOwnProperty","result","getCurrentOptions","state","routes","index","optionsFromListener","undefined","useEffect","getter","prev","hasAnyChildListener","useMemo"],"mappings":"AAAA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;AACA,OAAOC,sBAAP,MAAmC,0BAAnC;AAGA,eAAe,SAASC,iBAAT,CAA2B;AACxCC,EAAAA,GADwC;AAExCC,EAAAA,UAFwC;AAGxCC,EAAAA;AAHwC,CAA3B,EAQZ;AACD,MAAI,CACFC,yBADE,EAEFC,4BAFE,IAGAP,KAAK,CAACQ,QAAN,CAAe,CAAf,CAHJ;AAIA,QAAMC,uBAAuB,GAAGT,KAAK,CAACU,MAAN,CAE9B,EAF8B,CAAhC;AAIA,QAAM;AAAEC,IAAAA,gBAAgB,EAAEC;AAApB,MAA+CZ,KAAK,CAACa,UAAN,CACnDZ,sBADmD,CAArD;AAIA,QAAMa,sBAAsB,GAAGd,KAAK,CAACe,WAAN,CAAkB,MAAM;AACrD,SAAK,IAAIZ,GAAT,IAAgBM,uBAAuB,CAACO,OAAxC,EAAiD;AAC/C,UAAIP,uBAAuB,CAACO,OAAxB,CAAgCC,cAAhC,CAA+Cd,GAA/C,CAAJ,EAAyD;AAAA;;AACvD,cAAMe,MAAM,4BAAG,0BAAAT,uBAAuB,CAACO,OAAxB,EAAgCb,GAAhC,CAAH,0DAAG,kDAAf,CADuD,CAEvD;;AACA,YAAIe,MAAM,KAAK,IAAf,EAAqB;AACnB,iBAAOA,MAAP;AACD;AACF;AACF;;AACD,WAAO,IAAP;AACD,GAX8B,EAW5B,EAX4B,CAA/B;AAaA,QAAMC,iBAAiB,GAAGnB,KAAK,CAACe,WAAN,CAAkB,MAAM;AAAA;;AAChD,QAAIV,QAAJ,EAAc;AACZ,YAAMe,KAAK,GAAGf,QAAQ,EAAtB;;AACA,UAAIe,KAAK,CAACC,MAAN,CAAaD,KAAK,CAACE,KAAnB,EAA0BnB,GAA1B,KAAkCA,GAAtC,EAA2C;AACzC;AACA,eAAO,IAAP;AACD;AACF;;AAED,UAAMoB,mBAAmB,GAAGT,sBAAsB,EAAlD;;AACA,QAAIS,mBAAmB,KAAK,IAA5B,EAAkC;AAChC,aAAOA,mBAAP;AACD;;AACD,0BAAOnB,UAAP,aAAOA,UAAP,uBAAOA,UAAU,EAAjB,qDAAyBoB,SAAzB;AACD,GAdyB,EAcvB,CAACnB,QAAD,EAAWS,sBAAX,EAAmCV,UAAnC,EAA+CD,GAA/C,CAduB,CAA1B;AAgBAH,EAAAA,KAAK,CAACyB,SAAN,CAAgB,MAAM;AACpB,WAAOb,sBAAP,aAAOA,sBAAP,uBAAOA,sBAAsB,CAAGT,GAAH,EAASgB,iBAAT,CAA7B;AACD,GAFD,EAEG,CAACA,iBAAD,EAAoBP,sBAApB,EAA4CT,GAA5C,CAFH;AAIA,QAAMQ,gBAAgB,GAAGX,KAAK,CAACe,WAAN,CACvB,CAACZ,GAAD,EAAcuB,MAAd,KAA0D;AACxDjB,IAAAA,uBAAuB,CAACO,OAAxB,CAAgCb,GAAhC,IAAuCuB,MAAvC;AACAnB,IAAAA,4BAA4B,CAAEoB,IAAD,IAAUA,IAAI,GAAG,CAAlB,CAA5B;AAEA,WAAO,MAAM;AACXpB,MAAAA,4BAA4B,CAAEoB,IAAD,IAAUA,IAAI,GAAG,CAAlB,CAA5B,CADW,CAEX;;AACA,aAAOlB,uBAAuB,CAACO,OAAxB,CAAgCb,GAAhC,CAAP;AACD,KAJD;AAKD,GAVsB,EAWvB,EAXuB,CAAzB;AAcA,QAAMyB,mBAAmB,GAAG5B,KAAK,CAAC6B,OAAN,CAC1B,MAAMvB,yBAAyB,GAAG,CADR,EAE1B,CAACA,yBAAD,CAF0B,CAA5B;AAKA,SAAO;AACLK,IAAAA,gBADK;AAELQ,IAAAA,iBAFK;AAGLS,IAAAA;AAHK,GAAP;AAKD","sourcesContent":["import * as React from 'react';\nimport NavigationStateContext from './NavigationStateContext';\nimport type { NavigationState } from '@react-navigation/routers';\n\nexport default function useOptionsGetters({\n  key,\n  getOptions,\n  getState,\n}: {\n  key?: string;\n  getOptions?: () => object | undefined;\n  getState?: () => NavigationState;\n}) {\n  let [\n    numberOfChildrenListeners,\n    setNumberOfChildrenListeners,\n  ] = React.useState(0);\n  const optionsGettersFromChild = React.useRef<\n    Record<string, () => object | undefined | null>\n  >({});\n\n  const { addOptionsGetter: parentAddOptionsGetter } = React.useContext(\n    NavigationStateContext\n  );\n\n  const getOptionsFromListener = React.useCallback(() => {\n    for (let key in optionsGettersFromChild.current) {\n      if (optionsGettersFromChild.current.hasOwnProperty(key)) {\n        const result = optionsGettersFromChild.current[key]?.();\n        // null means unfocused route\n        if (result !== null) {\n          return result;\n        }\n      }\n    }\n    return null;\n  }, []);\n\n  const getCurrentOptions = React.useCallback(() => {\n    if (getState) {\n      const state = getState();\n      if (state.routes[state.index].key !== key) {\n        // null means unfocused route\n        return null;\n      }\n    }\n\n    const optionsFromListener = getOptionsFromListener();\n    if (optionsFromListener !== null) {\n      return optionsFromListener;\n    }\n    return getOptions?.() ?? undefined;\n  }, [getState, getOptionsFromListener, getOptions, key]);\n\n  React.useEffect(() => {\n    return parentAddOptionsGetter?.(key!, getCurrentOptions);\n  }, [getCurrentOptions, parentAddOptionsGetter, key]);\n\n  const addOptionsGetter = React.useCallback(\n    (key: string, getter: () => object | undefined | null) => {\n      optionsGettersFromChild.current[key] = getter;\n      setNumberOfChildrenListeners((prev) => prev + 1);\n\n      return () => {\n        setNumberOfChildrenListeners((prev) => prev - 1);\n        // eslint-disable-next-line @typescript-eslint/no-dynamic-delete\n        delete optionsGettersFromChild.current[key];\n      };\n    },\n    []\n  );\n\n  const hasAnyChildListener = React.useMemo(\n    () => numberOfChildrenListeners > 0,\n    [numberOfChildrenListeners]\n  );\n\n  return {\n    addOptionsGetter,\n    getCurrentOptions,\n    hasAnyChildListener,\n  };\n}\n"]}