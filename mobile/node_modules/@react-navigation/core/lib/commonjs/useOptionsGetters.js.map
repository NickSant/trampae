{"version":3,"sources":["useOptionsGetters.tsx"],"names":["useOptionsGetters","key","getOptions","getState","numberOfChildrenListeners","setNumberOfChildrenListeners","React","useState","optionsGettersFromChild","useRef","addOptionsGetter","parentAddOptionsGetter","useContext","NavigationStateContext","getOptionsFromListener","useCallback","current","hasOwnProperty","result","getCurrentOptions","state","routes","index","optionsFromListener","undefined","useEffect","getter","prev","hasAnyChildListener","useMemo"],"mappings":";;;;;;;AAAA;;AACA;;;;;;;;AAGe,SAASA,iBAAT,CAA2B;AACxCC,EAAAA,GADwC;AAExCC,EAAAA,UAFwC;AAGxCC,EAAAA;AAHwC,CAA3B,EAQZ;AACD,MAAI,CACFC,yBADE,EAEFC,4BAFE,IAGAC,KAAK,CAACC,QAAN,CAAe,CAAf,CAHJ;AAIA,QAAMC,uBAAuB,GAAGF,KAAK,CAACG,MAAN,CAE9B,EAF8B,CAAhC;AAIA,QAAM;AAAEC,IAAAA,gBAAgB,EAAEC;AAApB,MAA+CL,KAAK,CAACM,UAAN,CACnDC,+BADmD,CAArD;AAIA,QAAMC,sBAAsB,GAAGR,KAAK,CAACS,WAAN,CAAkB,MAAM;AACrD,SAAK,IAAId,GAAT,IAAgBO,uBAAuB,CAACQ,OAAxC,EAAiD;AAC/C,UAAIR,uBAAuB,CAACQ,OAAxB,CAAgCC,cAAhC,CAA+ChB,GAA/C,CAAJ,EAAyD;AAAA;;AACvD,cAAMiB,MAAM,4BAAG,0BAAAV,uBAAuB,CAACQ,OAAxB,EAAgCf,GAAhC,CAAH,0DAAG,kDAAf,CADuD,CAEvD;;AACA,YAAIiB,MAAM,KAAK,IAAf,EAAqB;AACnB,iBAAOA,MAAP;AACD;AACF;AACF;;AACD,WAAO,IAAP;AACD,GAX8B,EAW5B,EAX4B,CAA/B;AAaA,QAAMC,iBAAiB,GAAGb,KAAK,CAACS,WAAN,CAAkB,MAAM;AAAA;;AAChD,QAAIZ,QAAJ,EAAc;AACZ,YAAMiB,KAAK,GAAGjB,QAAQ,EAAtB;;AACA,UAAIiB,KAAK,CAACC,MAAN,CAAaD,KAAK,CAACE,KAAnB,EAA0BrB,GAA1B,KAAkCA,GAAtC,EAA2C;AACzC;AACA,eAAO,IAAP;AACD;AACF;;AAED,UAAMsB,mBAAmB,GAAGT,sBAAsB,EAAlD;;AACA,QAAIS,mBAAmB,KAAK,IAA5B,EAAkC;AAChC,aAAOA,mBAAP;AACD;;AACD,0BAAOrB,UAAP,aAAOA,UAAP,uBAAOA,UAAU,EAAjB,qDAAyBsB,SAAzB;AACD,GAdyB,EAcvB,CAACrB,QAAD,EAAWW,sBAAX,EAAmCZ,UAAnC,EAA+CD,GAA/C,CAduB,CAA1B;AAgBAK,EAAAA,KAAK,CAACmB,SAAN,CAAgB,MAAM;AACpB,WAAOd,sBAAP,aAAOA,sBAAP,uBAAOA,sBAAsB,CAAGV,GAAH,EAASkB,iBAAT,CAA7B;AACD,GAFD,EAEG,CAACA,iBAAD,EAAoBR,sBAApB,EAA4CV,GAA5C,CAFH;AAIA,QAAMS,gBAAgB,GAAGJ,KAAK,CAACS,WAAN,CACvB,CAACd,GAAD,EAAcyB,MAAd,KAA0D;AACxDlB,IAAAA,uBAAuB,CAACQ,OAAxB,CAAgCf,GAAhC,IAAuCyB,MAAvC;AACArB,IAAAA,4BAA4B,CAAEsB,IAAD,IAAUA,IAAI,GAAG,CAAlB,CAA5B;AAEA,WAAO,MAAM;AACXtB,MAAAA,4BAA4B,CAAEsB,IAAD,IAAUA,IAAI,GAAG,CAAlB,CAA5B,CADW,CAEX;;AACA,aAAOnB,uBAAuB,CAACQ,OAAxB,CAAgCf,GAAhC,CAAP;AACD,KAJD;AAKD,GAVsB,EAWvB,EAXuB,CAAzB;AAcA,QAAM2B,mBAAmB,GAAGtB,KAAK,CAACuB,OAAN,CAC1B,MAAMzB,yBAAyB,GAAG,CADR,EAE1B,CAACA,yBAAD,CAF0B,CAA5B;AAKA,SAAO;AACLM,IAAAA,gBADK;AAELS,IAAAA,iBAFK;AAGLS,IAAAA;AAHK,GAAP;AAKD","sourcesContent":["import * as React from 'react';\nimport NavigationStateContext from './NavigationStateContext';\nimport type { NavigationState } from '@react-navigation/routers';\n\nexport default function useOptionsGetters({\n  key,\n  getOptions,\n  getState,\n}: {\n  key?: string;\n  getOptions?: () => object | undefined;\n  getState?: () => NavigationState;\n}) {\n  let [\n    numberOfChildrenListeners,\n    setNumberOfChildrenListeners,\n  ] = React.useState(0);\n  const optionsGettersFromChild = React.useRef<\n    Record<string, () => object | undefined | null>\n  >({});\n\n  const { addOptionsGetter: parentAddOptionsGetter } = React.useContext(\n    NavigationStateContext\n  );\n\n  const getOptionsFromListener = React.useCallback(() => {\n    for (let key in optionsGettersFromChild.current) {\n      if (optionsGettersFromChild.current.hasOwnProperty(key)) {\n        const result = optionsGettersFromChild.current[key]?.();\n        // null means unfocused route\n        if (result !== null) {\n          return result;\n        }\n      }\n    }\n    return null;\n  }, []);\n\n  const getCurrentOptions = React.useCallback(() => {\n    if (getState) {\n      const state = getState();\n      if (state.routes[state.index].key !== key) {\n        // null means unfocused route\n        return null;\n      }\n    }\n\n    const optionsFromListener = getOptionsFromListener();\n    if (optionsFromListener !== null) {\n      return optionsFromListener;\n    }\n    return getOptions?.() ?? undefined;\n  }, [getState, getOptionsFromListener, getOptions, key]);\n\n  React.useEffect(() => {\n    return parentAddOptionsGetter?.(key!, getCurrentOptions);\n  }, [getCurrentOptions, parentAddOptionsGetter, key]);\n\n  const addOptionsGetter = React.useCallback(\n    (key: string, getter: () => object | undefined | null) => {\n      optionsGettersFromChild.current[key] = getter;\n      setNumberOfChildrenListeners((prev) => prev + 1);\n\n      return () => {\n        setNumberOfChildrenListeners((prev) => prev - 1);\n        // eslint-disable-next-line @typescript-eslint/no-dynamic-delete\n        delete optionsGettersFromChild.current[key];\n      };\n    },\n    []\n  );\n\n  const hasAnyChildListener = React.useMemo(\n    () => numberOfChildrenListeners > 0,\n    [numberOfChildrenListeners]\n  );\n\n  return {\n    addOptionsGetter,\n    getCurrentOptions,\n    hasAnyChildListener,\n  };\n}\n"]}