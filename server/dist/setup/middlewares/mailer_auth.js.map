{"version":3,"sources":["../../../src/setup/middlewares/mailer_auth.js"],"names":["jwt","u","Model","cp","Util","handleError","module","exports","req","res","next","url_hash","headers","body","not_middleware","undefined","get","hash_url","occurence","user_id","id","user","console","log","password","json","auth","end","mailerAuth"],"mappings":";;;;AAAA;;IAAYA,G;;AACZ;;;;AACA;;;;AAGA;;;;;;;;;;AACA,IAAMC,IAAI,IAAIC,eAAJ,CAAU,OAAV,CAAV;AACA,IAAMC,KAAK,IAAID,eAAJ,CAAU,yBAAV,CAAX;;WAEsB,IAAIE,cAAJ,E;IAAfC,W,QAAAA,W;;AAEPC,OAAOC,OAAP;AAAA,wEAAiB,iBAA0BC,GAA1B,EAA+BC,GAA/B,EAAoCC,IAApC;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAEDC,gCAFC,GAEYH,IAAII,OAFhB,CAEDD,QAFC;AAAA,gDAGwBH,IAAIK,IAH5B,CAGDC,cAHC,EAGDA,cAHC,yCAGc,KAHd;;AAAA,8BAKNH,aAAaI,SAAb,IAA0BJ,aAAa,IAAvC,IAA+C,QAAOA,QAAP,yCAAOA,QAAP,OAAoBI,SAL7D;AAAA;AAAA;AAAA;;AAAA,yDAK+EV,YAAYI,GAAZ,EAAgB,GAAhB,EAAoB,kBAApB,CAL/E;;AAAA;AAAA;AAAA,+BAQeN,GAAGa,GAAH,CAAO,EAACC,UAAUN,QAAX,EAAP,EAA6B,IAA7B,CARf;;AAAA;AAQHO,iCARG;;AAAA,8BAWN,CAACA,UAAUC,OAAX,IAAsBD,UAAUC,OAAV,KAAsBJ,SAXtC;AAAA;AAAA;AAAA;;AAAA,yDAWwDV,YAAYI,GAAZ,EAAiB,GAAjB,EAAsB,cAAtB,CAXxD;;AAAA;AAAA;AAAA,+BAaUR,EAAEe,GAAF,CAAM,EAACI,IAAIF,UAAUC,OAAf,EAAN,EAA+B,IAA/B,CAbV;;AAAA;AAaHE,4BAbG;;AAcTC,gCAAQC,GAAR,CAAYF,IAAZ;;AAdS,4BAgBLA,IAhBK;AAAA;AAAA;AAAA;;AAAA,yDAgBQhB,YAAYI,GAAZ,EAAiB,GAAjB,EAAsB,cAAtB,CAhBR;;AAAA;;AAkBf,+BAAOY,KAAKG,QAAZ;AACMhB,4BAAIa,IAAJ,GAAWA,IAAX;;AAnBS,6BAqBNP,cArBM;AAAA;AAAA;AAAA;;AAAA,yDAqBiBL,IAAIgB,IAAJ,CAAS,EAACJ,MAAMA,IAAP,EAAaK,MAAK,IAAlB,EAAT,EAAkCC,GAAlC,EArBjB;;AAAA;;AAuBTjB;AAvBS;AAAA;;AAAA;AAAA;AAAA;AAAA,yDAyBFL,YAAYI,GAAZ,EAAiB,GAAjB,EAAsB,qBAAtB,CAzBE;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAjB;;AAAA,aAAgCmB,UAAhC;AAAA;AAAA;;AAAA,WAAgCA,UAAhC;AAAA","file":"mailer_auth.js","sourcesContent":["import * as jwt from '../jwt';\nimport connection from '../../database/connection';\nimport Util from '../../helpers/Util';\n\n\nimport Model from '../../models/Model'\nconst u = new Model('users')\nconst cp = new Model('change_pass_occurrences')\n\nconst {handleError} = new Util;\n\nmodule.exports = async function mailerAuth(req, res, next){\n    try{\n        const { url_hash } = req.headers\n        const { not_middleware=false } = req.body\n\n        if(url_hash === undefined || url_hash === null || typeof url_hash === undefined) return handleError(res,401,'incompleted_info')\n        \n        \n        const occurence = await cp.get({hash_url: url_hash}, true)\n\n        \n        if(!occurence.user_id || occurence.user_id === undefined) return handleError(res, 401, 'unauthorized')\n\n        const user = await u.get({id: occurence.user_id}, true)\n        console.log(user)\n\n        if(!user) return handleError(res, 401, 'unauthorized')\n    \n\t\tdelete user.password\n        req.user = user \n\n        if(not_middleware) return res.json({user: user, auth:true}).end()\n\n        next()\n    }catch(e){\n        return handleError(res, 401, 'unauthorized(catch)');\n    }\n}"]}